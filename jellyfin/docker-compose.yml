version: "3.8"

services:
  jellyfin:
    image: linuxserver/jellyfin:latest
    container_name: jellyfin
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/UTC}
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/jellyfin:/config
      - ${MEDIA_LOCATION:-/home/dagmarb/jellyfin/media}:/media
      - ${DOWNLOADS_LOCATION:-/home/dagmarb/jellyfin/downloads}:/downloads
    ports:
      - "8096:8096"
      - "8920:8920"
    restart: unless-stopped
    devices:
      - /dev/dri:/dev/dri # optional: Intel VA-API
    networks:
      - shared

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/UTC}
      - WEBUI_PORT=8080
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/qbittorrent:/config
      - ${DOWNLOADS_LOCATION:-/home/dagmarb/jellyfin/downloads}:/downloads
    ports:
      - "${QBIT_WEBUI_PORT:-8081}:8080"
      - "6881:6881"
      - "6881:6881/udp"
    restart: unless-stopped
    networks:
      - shared

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    depends_on:
      - media-setup
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/UTC}
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/radarr:/config
      - ${MEDIA_LOCATION:-/home/dagmarb/jellyfin/media}/movies:/movies
      - ${DOWNLOADS_LOCATION:-/home/dagmarb/jellyfin/downloads}:/downloads
    ports:
      - "7878:7878"
    restart: unless-stopped
    networks:
      - shared

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    depends_on:
      - media-setup
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/UTC}
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/sonarr:/config
      - ${MEDIA_LOCATION:-/home/dagmarb/jellyfin/media}/tv:/tv
      - ${DOWNLOADS_LOCATION:-/home/dagmarb/jellyfin/downloads}:/downloads
    ports:
      - "8989:8989"
    restart: unless-stopped
    networks:
      - shared

  lidarr:
    image: lscr.io/linuxserver/lidarr:latest
    container_name: lidarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/UTC}
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/lidarr:/config
      - ${MEDIA_LOCATION:-/home/dagmarb/jellyfin/media}/music:/music
      - ${DOWNLOADS_LOCATION:-/home/dagmarb/jellyfin/downloads}:/downloads
    ports:
      - "8686:8686"
    restart: unless-stopped
    networks:
      - shared

  readarr:
    image: ghcr.io/pennydreadful/bookshelf:softcover
    container_name: readarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/UTC}
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/readarr:/config
      - ${MEDIA_LOCATION:-/home/dagmarb/jellyfin/media}/audiobooks:/audiobooks
      - ${DOWNLOADS_LOCATION:-/home/dagmarb/jellyfin/downloads}:/downloads
    ports:
      - "8787:8787"
    restart: unless-stopped
    networks:
      - shared

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/UTC}
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/prowlarr:/config
    ports:
      - "9696:9696"
    restart: unless-stopped
    networks:
      - shared

  seerr-setup:
    image: alpine:latest
    container_name: seerr-setup
    command: sh -c "mkdir -p /app/config && chown -R 1000:1000 /app/config && chmod -R 755 /app/config"
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/seerr:/app/config
    restart: "no"

  media-setup:
    image: alpine:latest
    container_name: media-setup
    command: sh -c "chown -R 1000:1000 /media && chmod -R 755 /media"
    volumes:
      - ${MEDIA_LOCATION:-/home/dagmarb/jellyfin/media}:/media
    restart: "no"

  seerr:
    image: seerr/seerr:latest
    container_name: seerr
    depends_on:
      - seerr-setup
      - media-setup
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/UTC}
      - TMDB_API_KEY=${TMDB_API_KEY}
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/seerr:/app/config
      - ${MEDIA_LOCATION:-/home/dagmarb/jellyfin/media}/movies:/movies
      - ${MEDIA_LOCATION:-/home/dagmarb/jellyfin/media}/tv:/tv
    ports:
      - "5055:5055"
    restart: unless-stopped
    networks:
      - shared

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    depends_on:
      - media-setup
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/UTC}
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/bazarr:/config
      - ${MEDIA_LOCATION:-/home/dagmarb/jellyfin/media}:/media
      - ${DOWNLOADS_LOCATION:-/home/dagmarb/jellyfin/downloads}:/downloads
    ports:
      - "6767:6767"
    restart: unless-stopped
    networks:
      - shared

  tdarr:
    image: ghcr.io/haveagitgat/tdarr:latest
    container_name: tdarr
    depends_on:
      - media-setup
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/UTC}
      - UMASK_SET=002
      - serverIP=0.0.0.0
      - serverPort=8266
      - webUIPort=8265
      - internalNode=true
      - inContainer=true
      - ffmpegVersion=7
      - nodeName=MyInternalNode
      - auth=false
      - openBrowser=false
      - maxLogSizeMB=10
      - cronPluginUpdate=
    volumes:
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/tdarr/server:/app/server
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/tdarr/configs:/app/configs
      - ${CONFIG_LOCATION:-/home/dagmarb/jellyfin/config}/tdarr/logs:/app/logs
      - ${MEDIA_LOCATION:-/home/dagmarb/jellyfin/media}:/media
      - ${TRANSCODE_CACHE:-/transcode_cache}:/temp
    ports:
      - "8265:8265" # Tdarr WebUI
      - "8266:8266" # Tdarr Server
    devices:
      - /dev/dri:/dev/dri # optional: Intel/AMD hardware acceleration
    restart: unless-stopped
    networks:
      - shared

networks:
  shared:
    external: true

volumes: {}
